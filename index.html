<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cronograma â€” SeminÃ¡rio SIO 2026</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0f1117;
    --surface: #171b26;
    --surface2: #1e2333;
    --border: #2a2f42;
    --text: #e8eaf0;
    --text-muted: #6b7280;
    --text-dim: #9ca3b0;

    --coord:    #6c8eff;
    --logistica:#f97316;
    --programa: #22d3a0;
    --comms:    #e879f9;
    --patroc:   #facc15;
    --acomp:    #f87171;

    --done:     #22c55e;
    --progress: #3b82f6;
    --todo:     #64748b;
    --late:     #ef4444;

    --today-line: #ff6b6b;
    --milestone: #ffd700;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Mono', monospace;
    font-size: 13px;
    min-height: 100vh;
  }

  /* â”€â”€ HEADER â”€â”€ */
  .header {
    padding: 28px 32px 20px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 16px;
    background: var(--surface);
  }
  .header-left h1 {
    font-family: 'DM Serif Display', serif;
    font-size: 26px;
    font-weight: 400;
    letter-spacing: -0.3px;
    color: #fff;
  }
  .header-left .subtitle {
    font-size: 11px;
    color: var(--text-muted);
    margin-top: 4px;
    letter-spacing: 0.5px;
    text-transform: uppercase;
  }
  .export-date {
    font-size: 11px;
    color: var(--text-muted);
    background: var(--surface2);
    padding: 6px 12px;
    border-radius: 6px;
    border: 1px solid var(--border);
  }

  /* â”€â”€ STATS BAR â”€â”€ */
  .stats-bar {
    display: flex;
    gap: 20px;
    padding: 14px 32px;
    background: var(--surface2);
    border-bottom: 1px solid var(--border);
    flex-wrap: wrap;
  }
  .stat {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 12px;
    color: var(--text-dim);
  }
  .stat-dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
  }
  .stat strong { color: var(--text); font-weight: 500; }

  /* â”€â”€ CONTROLS â”€â”€ */
  .controls {
    display: flex;
    gap: 12px;
    padding: 14px 32px;
    align-items: center;
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    flex-wrap: wrap;
  }
  .controls label {
    font-size: 11px;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-right: 4px;
  }
  .controls select, .controls button {
    background: var(--surface2);
    color: var(--text);
    border: 1px solid var(--border);
    padding: 6px 12px;
    border-radius: 6px;
    font-family: 'DM Mono', monospace;
    font-size: 12px;
    cursor: pointer;
    transition: border-color 0.15s, background 0.15s;
  }
  .controls select:hover, .controls button:hover {
    border-color: var(--coord);
    background: var(--surface2);
  }
  .btn-today {
    background: var(--coord) !important;
    color: #fff !important;
    border-color: var(--coord) !important;
    font-weight: 500;
  }
  .controls .sep {
    width: 1px; height: 24px;
    background: var(--border);
  }
  .zoom-group { display: flex; gap: 4px; }
  .zoom-group button { padding: 6px 10px; font-size: 14px; }

  /* â”€â”€ MAIN LAYOUT â”€â”€ */
  .gantt-wrapper {
    display: flex;
    height: calc(100vh - 195px);
    min-height: 400px;
    overflow: hidden;
  }

  /* â”€â”€ LEFT PANEL â”€â”€ */
  .task-panel {
    width: 320px;
    min-width: 320px;
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }
  .task-panel-header {
    display: grid;
    grid-template-columns: 1fr 80px 70px;
    padding: 10px 16px;
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--text-muted);
    border-bottom: 1px solid var(--border);
    background: var(--surface2);
    flex-shrink: 0;
  }
  .task-list {
    overflow-y: auto;
    flex: 1;
  }
  .task-list::-webkit-scrollbar { width: 4px; }
  .task-list::-webkit-scrollbar-track { background: transparent; }
  .task-list::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

  /* bucket header */
  .bucket-header {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 500;
    background: var(--surface2);
    border-top: 1px solid var(--border);
    border-bottom: 1px solid var(--border);
    cursor: pointer;
    user-select: none;
    position: sticky;
    top: 0;
    z-index: 2;
  }
  .bucket-header:hover { background: #252b3a; }
  .bucket-dot { width: 6px; height: 6px; border-radius: 50%; }
  .bucket-name { flex: 1; }
  .bucket-count {
    background: var(--surface);
    color: var(--text-muted);
    padding: 1px 7px;
    border-radius: 10px;
    font-size: 10px;
  }
  .bucket-toggle { color: var(--text-muted); font-size: 10px; transition: transform 0.2s; }
  .bucket-toggle.collapsed { transform: rotate(-90deg); }

  /* task row */
  .task-row {
    display: grid;
    grid-template-columns: 1fr 80px 70px;
    align-items: center;
    padding: 7px 16px;
    border-bottom: 1px solid #1a1f2e;
    cursor: pointer;
    transition: background 0.1s;
    min-height: 36px;
  }
  .task-row:hover { background: #1a2035; }
  .task-row.highlighted { background: #1e2a45; }
  .task-name {
    font-size: 12px;
    color: var(--text);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    padding-right: 8px;
  }
  .task-name .late-icon { color: var(--late); margin-left: 4px; }
  .task-assignee {
    font-size: 10px;
    color: var(--text-muted);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .status-badge {
    font-size: 9px;
    padding: 2px 7px;
    border-radius: 4px;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    font-weight: 500;
    text-align: center;
    white-space: nowrap;
  }
  .status-Completed { background: #14532d; color: #4ade80; }
  .status-In-progress { background: #1e3a5f; color: #60a5fa; }
  .status-Not-started { background: #1e2333; color: #64748b; }

  /* â”€â”€ RIGHT (GANTT) PANEL â”€â”€ */
  .chart-panel {
    flex: 1;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    position: relative;
  }
  .chart-scroll {
    overflow-x: auto;
    overflow-y: auto;
    flex: 1;
  }
  .chart-scroll::-webkit-scrollbar { height: 6px; width: 4px; }
  .chart-scroll::-webkit-scrollbar-track { background: transparent; }
  .chart-scroll::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

  .chart-inner {
    position: relative;
  }

  /* time header */
  .time-header {
    position: sticky;
    top: 0;
    z-index: 10;
    background: var(--surface2);
    border-bottom: 1px solid var(--border);
    display: flex;
    height: 38px;
    align-items: stretch;
  }
  .month-label {
    position: absolute;
    top: 0;
    font-size: 9px;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    color: var(--text-muted);
    padding: 4px 8px 0;
    border-left: 1px solid var(--border);
    pointer-events: none;
    height: 38px;
  }
  .week-cell {
    display: flex;
    align-items: flex-end;
    justify-content: center;
    padding-bottom: 5px;
    font-size: 10px;
    color: var(--text-muted);
    border-right: 1px solid var(--border);
    position: relative;
    flex-shrink: 0;
  }
  .week-cell.today-week {
    color: var(--today-line);
    font-weight: 600;
  }

  /* grid rows */
  .chart-rows {
    position: relative;
  }
  .chart-row {
    height: 36px;
    border-bottom: 1px solid #1a1f2e;
    position: relative;
  }
  .chart-row:hover .row-bg { opacity: 1; }
  .row-bg {
    position: absolute;
    inset: 0;
    background: rgba(255,255,255,0.015);
    opacity: 0;
    transition: opacity 0.1s;
    pointer-events: none;
  }
  .bucket-spacer {
    height: 31px;
    border-bottom: 1px solid var(--border);
    background: var(--surface2);
  }

  /* vertical grid lines */
  .grid-line {
    position: absolute;
    top: 0; bottom: 0;
    width: 1px;
    background: #1e2333;
    pointer-events: none;
  }
  .grid-line.month { background: #2a2f42; }

  /* today line */
  .today-line {
    position: absolute;
    top: 0; bottom: 0;
    width: 2px;
    background: var(--today-line);
    pointer-events: none;
    z-index: 5;
  }
  .today-line::before {
    content: 'HOJE';
    position: absolute;
    top: 2px;
    left: 4px;
    font-size: 8px;
    color: var(--today-line);
    letter-spacing: 0.5px;
    white-space: nowrap;
  }

  /* â”€â”€ BARS â”€â”€ */
  .gantt-bar {
    position: absolute;
    height: 18px;
    top: 50%;
    transform: translateY(-50%);
    border-radius: 3px;
    cursor: pointer;
    transition: filter 0.15s, transform 0.1s;
    display: flex;
    align-items: center;
    overflow: hidden;
    min-width: 4px;
    z-index: 3;
  }
  .gantt-bar:hover {
    filter: brightness(1.25);
    transform: translateY(-50%) scaleY(1.1);
    z-index: 10;
  }
  .bar-progress {
    position: absolute;
    left: 0; top: 0; bottom: 0;
    background: rgba(255,255,255,0.25);
    pointer-events: none;
  }
  .bar-label {
    font-size: 10px;
    color: rgba(255,255,255,0.9);
    padding: 0 6px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    position: relative;
    z-index: 1;
    pointer-events: none;
  }

  /* milestone diamond */
  .gantt-milestone {
    position: absolute;
    width: 12px; height: 12px;
    top: 50%; transform: translateY(-50%) rotate(45deg);
    background: var(--milestone);
    cursor: pointer;
    z-index: 4;
    transition: transform 0.1s;
    border-radius: 2px;
  }
  .gantt-milestone:hover {
    transform: translateY(-50%) rotate(45deg) scale(1.3);
    filter: brightness(1.3);
  }

  /* â”€â”€ TOOLTIP (hover rÃ¡pido) â”€â”€ */
  .tooltip {
    position: fixed;
    background: #1a1f2e;
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 10px 14px;
    max-width: 260px;
    z-index: 1000;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.12s;
    box-shadow: 0 8px 32px rgba(0,0,0,0.5);
  }
  .tooltip.visible { opacity: 1; }
  .tt-title {
    font-size: 12px;
    font-weight: 500;
    color: #fff;
    margin-bottom: 6px;
    line-height: 1.4;
  }
  .tt-hint {
    font-size: 10px;
    color: var(--coord);
    margin-top: 6px;
    padding-top: 6px;
    border-top: 1px solid var(--border);
    opacity: 0.8;
  }

  /* â”€â”€ DETAIL PANEL â”€â”€ */
  .detail-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.5);
    z-index: 200;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
  }
  .detail-overlay.open {
    opacity: 1;
    pointer-events: all;
  }
  .detail-panel {
    position: fixed;
    top: 0; right: 0; bottom: 0;
    width: 420px;
    max-width: 90vw;
    background: #171b26;
    border-left: 1px solid var(--border);
    z-index: 300;
    display: flex;
    flex-direction: column;
    transform: translateX(100%);
    transition: transform 0.25s cubic-bezier(0.4,0,0.2,1);
    box-shadow: -8px 0 40px rgba(0,0,0,0.4);
  }
  .detail-panel.open {
    transform: translateX(0);
  }
  .dp-header {
    padding: 20px 24px 16px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: flex-start;
    gap: 12px;
    flex-shrink: 0;
  }
  .dp-status-dot {
    width: 10px; height: 10px;
    border-radius: 50%;
    margin-top: 5px;
    flex-shrink: 0;
  }
  .dp-title {
    font-family: 'DM Serif Display', serif;
    font-size: 20px;
    color: #fff;
    line-height: 1.3;
    flex: 1;
  }
  .dp-close {
    background: none;
    border: none;
    color: var(--text-muted);
    font-size: 20px;
    cursor: pointer;
    padding: 0 4px;
    line-height: 1;
    flex-shrink: 0;
    transition: color 0.15s;
  }
  .dp-close:hover { color: var(--text); }

  .dp-meta {
    padding: 16px 24px;
    border-bottom: 1px solid var(--border);
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    flex-shrink: 0;
  }
  .dp-meta-item {}
  .dp-meta-label {
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--text-muted);
    margin-bottom: 3px;
  }
  .dp-meta-value {
    font-size: 12px;
    color: var(--text);
  }
  .dp-status-badge {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 3px 10px;
    border-radius: 5px;
    font-size: 11px;
    font-weight: 500;
  }

  .dp-notes-section {
    padding: 20px 24px;
    flex: 1;
    overflow-y: auto;
  }
  .dp-notes-section::-webkit-scrollbar { width: 4px; }
  .dp-notes-section::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

  .dp-section-label {
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    color: var(--text-muted);
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .dp-section-label::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--border);
  }

  .dp-notes-content {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 16px;
    font-size: 13px;
    color: var(--text-dim);
    line-height: 1.7;
    white-space: pre-wrap;
    word-break: break-word;
    min-height: 80px;
  }
  .dp-notes-empty {
    font-size: 12px;
    color: var(--text-muted);
    font-style: italic;
    padding: 16px;
    text-align: center;
    background: var(--surface2);
    border: 1px dashed var(--border);
    border-radius: 8px;
  }

  .dp-assignees {
    margin-top: 20px;
  }
  .dp-assignee-list {
    display: flex;
    flex-direction: column;
    gap: 6px;
    margin-top: 10px;
  }
  .dp-assignee-chip {
    display: flex;
    align-items: center;
    gap: 8px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 7px 12px;
    font-size: 12px;
    color: var(--text-dim);
  }
  .dp-assignee-avatar {
    width: 24px; height: 24px;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 10px;
    font-weight: 600;
    color: #fff;
    flex-shrink: 0;
  }

  .dp-footer {
    padding: 12px 24px;
    border-top: 1px solid var(--border);
    flex-shrink: 0;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .dp-late-badge {
    background: #2d1515;
    color: #ef4444;
    border: 1px solid #3d1f1f;
    padding: 4px 10px;
    border-radius: 5px;
    font-size: 11px;
  }
  .dp-progress-bar {
    flex: 1;
    height: 4px;
    background: var(--surface2);
    border-radius: 2px;
    overflow: hidden;
  }
  .dp-progress-fill {
    height: 100%;
    border-radius: 2px;
    transition: width 0.3s;
  }

  /* â”€â”€ LEGEND â”€â”€ */
  .legend {
    display: flex;
    gap: 20px;
    padding: 10px 32px;
    background: var(--surface);
    border-top: 1px solid var(--border);
    flex-wrap: wrap;
    flex-shrink: 0;
  }
  .legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 11px;
    color: var(--text-muted);
  }
  .legend-bar {
    width: 20px; height: 8px;
    border-radius: 2px;
  }
  .legend-diamond {
    width: 8px; height: 8px;
    background: var(--milestone);
    transform: rotate(45deg);
    border-radius: 1px;
  }

  .hidden-bucket .task-row,
  .hidden-bucket .chart-row { display: none !important; }
  .hidden-bucket .bucket-spacer { display: none !important; }

  /* progress ring */
  .progress-ring { position: relative; display: inline-flex; align-items: center; }
</style>
</head>
<body>

<div class="header">
  <div class="header-left">
    <h1>SeminÃ¡rio SIO 2026 â€” Cronograma</h1>
    <div class="subtitle">Equipa de CoordenaÃ§Ã£o Â· Engenharia InformÃ¡tica</div>
  </div>
  <div class="export-date" id="exportDate">Exportado em: â€”</div>
</div>

<div class="stats-bar" id="statsBar"></div>

<div class="controls">
  <label>Filtrar</label>
  <select id="filterBucket">
    <option value="all">Todas as equipas</option>
  </select>
  <select id="filterStatus">
    <option value="all">Todos os estados</option>
    <option value="Completed">ConcluÃ­do</option>
    <option value="In progress">Em progresso</option>
    <option value="Not started">Por iniciar</option>
  </select>
  <div class="sep"></div>
  <label>Zoom</label>
  <div class="zoom-group">
    <button onclick="changeZoom(-5)">âˆ’</button>
    <button onclick="changeZoom(5)">+</button>
  </div>
  <button class="btn-today" onclick="scrollToToday()">â¬¤ Hoje</button>
</div>

<div class="gantt-wrapper">
  <div class="task-panel">
    <div class="task-panel-header">
      <span>Tarefa</span>
      <span>ResponsÃ¡vel</span>
      <span>Estado</span>
    </div>
    <div class="task-list" id="taskList"></div>
  </div>
  <div class="chart-panel">
    <div class="chart-scroll" id="chartScroll">
      <div class="chart-inner" id="chartInner"></div>
    </div>
  </div>
</div>

<div class="legend">
  <div class="legend-item"><div class="legend-bar" style="background:#22c55e"></div> ConcluÃ­do</div>
  <div class="legend-item"><div class="legend-bar" style="background:#3b82f6"></div> Em progresso</div>
  <div class="legend-item"><div class="legend-bar" style="background:#64748b"></div> Por iniciar</div>
  <div class="legend-item"><div class="legend-bar" style="background:#ef4444"></div> Em atraso</div>
  <div class="legend-item"><div class="legend-diamond"></div> Marco</div>
  <div class="legend-item" style="margin-left:auto;color:var(--text-muted);font-size:11px;">
    â† arrasta para navegar Â· clica numa tarefa para ver notas e detalhes
  </div>
</div>

<div class="tooltip" id="tooltip"></div>

<!-- Detail Panel -->
<div class="detail-overlay" id="detailOverlay" onclick="closeDetailPanel()"></div>
<div class="detail-panel" id="detailPanel">
  <div class="dp-header">
    <div class="dp-status-dot" id="dpStatusDot"></div>
    <div class="dp-title" id="dpTitle">â€”</div>
    <button class="dp-close" onclick="closeDetailPanel()">Ã—</button>
  </div>
  <div class="dp-meta" id="dpMeta"></div>
  <div class="dp-notes-section" id="dpNotesSection"></div>
  <div class="dp-footer" id="dpFooter"></div>
</div>

<script>
// â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const RAW_TASKS = [
  {"Task ID":"-yeXLdE74keC1S8yNvVl_pYAJb2Y","Task Name":"Selecionar Oradores e Moderadores","Bucket Name":"Equipa de CoordenaÃ§Ã£o","Status":"Not started","Priority":"Important","Assigned To":null,"Created Date":"2026-02-16T18:38:02.3282977Z","Due date":"2026-03-10T10:00:00+00:00","Start date":null,"Late":"false","Completed Date":null,"Labels":"Data Importante","Description":null},
  {"Task ID":"1mLtYGoBqkCdYsZs9zeZrJYAP-f7","Task Name":"Contactar com Parceiros","Bucket Name":"Equipa de CoordenaÃ§Ã£o","Status":"Not started","Priority":"Important","Assigned To":null,"Created Date":"2026-02-16T18:37:30.4786371Z","Due date":"2026-03-03T10:00:00+00:00","Start date":null,"Late":"false","Completed Date":null,"Labels":"Data Importante","Description":null},
  {"Task ID":"DnCacAZnD0W0z3CYySxTG5YACA2_","Task Name":"SeminÃ¡rio","Bucket Name":"Equipa de CoordenaÃ§Ã£o","Status":"In progress","Priority":"Urgent","Assigned To":null,"Created Date":"2026-02-16T16:30:45.1230668Z","Due date":"2026-05-26T10:00:00+00:00","Start date":"2026-05-26T10:00:00+00:00","Late":"false","Completed Date":null,"Labels":"Data Importante","Description":null},
  {"Task ID":"KEGJYv3KBEiypZF62wzpt5YAHHXe","Task Name":"InÃ­cio da DivulgaÃ§Ã£o a 28/04","Bucket Name":"Equipa de CoordenaÃ§Ã£o","Status":"Not started","Priority":"Important","Assigned To":null,"Created Date":"2026-02-16T18:40:17.5383963Z","Due date":"2026-05-25T10:00:00+00:00","Start date":"2026-04-28T10:00:00+00:00","Late":"false","Completed Date":null,"Labels":"Data Importante","Description":"ComeÃ§ar a divulgar o seminÃ¡rio e terminar atÃ© Ã  vÃ©spera do mesmo ou atÃ© esgotarem as inscriÃ§Ãµes"},
  {"Task ID":"RyWxD-ELDEq2BrqOWA2j15YAKvUx","Task Name":"Confirmar Oradores/Moderadores + Definir Identidade Visual","Bucket Name":"Equipa de CoordenaÃ§Ã£o","Status":"Not started","Priority":"Important","Assigned To":null,"Created Date":"2026-02-16T18:39:07.1041358Z","Due date":"2026-04-14T10:00:00+00:00","Start date":null,"Late":"false","Completed Date":null,"Labels":"Data Importante","Description":null},
  {"Task ID":"W7zMaDo-QE6OUS3Uj9Sa_5YAJVYZ","Task Name":"CriaÃ§Ã£o do Cronograma","Bucket Name":"Equipa de CoordenaÃ§Ã£o","Status":"Completed","Priority":"Important","Assigned To":"Cristiana Filipa Cunha Pinheiro","Created Date":"2026-02-16T16:17:00.7378386Z","Due date":"2026-02-21T10:00:00+00:00","Start date":"2026-02-14T10:00:00+00:00","Late":"false","Completed Date":"2026-02-21T16:34:02.9515971Z","Labels":null,"Description":"Feito pela Cristiana Pinheiro no Planner"},
  {"Task ID":"XVCERrPhT022cuVQqcaHMpYAI9n1","Task Name":"CriaÃ§Ã£o de FormulÃ¡rio para colocaÃ§Ã£o de estudantes em equipas","Bucket Name":"Equipa de CoordenaÃ§Ã£o","Status":"Completed","Priority":"Important","Assigned To":"Rui Miguel Teixeira Borges De AraÃºjo","Created Date":"2026-02-16T16:15:10.4527753Z","Due date":"2026-02-16T10:00:00+00:00","Start date":"2026-02-14T10:00:00+00:00","Late":"false","Completed Date":"2026-02-16T16:15:27.4855489Z","Labels":null,"Description":null},
  {"Task ID":"ZCLdzzs3Kk6GokokMUhnV5YAEXJn","Task Name":"Procura de auditÃ³rios no Porto","Bucket Name":"Equipa de CoordenaÃ§Ã£o","Status":"Completed","Priority":"Important","Assigned To":"Ana Sofia GonÃ§alves Vaz","Created Date":"2026-02-16T16:13:44.9626663Z","Due date":"2026-02-21T10:00:00+00:00","Start date":"2026-02-14T10:00:00+00:00","Late":"false","Completed Date":"2026-02-21T13:12:37.6021883Z","Labels":null,"Description":"ÃšNICA RESPOSTA-POLO ZERO"},
  {"Task ID":"c7ozahQs8EyyyQKyzmWGYJYAGXLC","Task Name":"Reserva de AuditÃ³rio","Bucket Name":"Equipa de CoordenaÃ§Ã£o","Status":"In progress","Priority":"Urgent","Assigned To":null,"Created Date":"2026-02-16T18:36:42.049377Z","Due date":"2026-02-24T10:00:00+00:00","Start date":null,"Late":"false","Completed Date":null,"Labels":"Data Importante","Description":"ComeÃ§amos a reunir propostas para apresentar na aula de dia 24/02"},
  {"Task ID":"eHtw7QtkT0KUsnxR2hkrEZYAEcLm","Task Name":"InÃ­cio das InscriÃ§Ãµes a 12/05","Bucket Name":"Equipa de CoordenaÃ§Ã£o","Status":"Not started","Priority":"Important","Assigned To":null,"Created Date":"2026-02-16T18:41:35.4968506Z","Due date":"2026-05-25T10:00:00+00:00","Start date":"2026-05-12T10:00:00+00:00","Late":"false","Completed Date":null,"Labels":"Data Importante","Description":"InscriÃ§Ãµes abertas atÃ© Ã  vÃ©spera do seminÃ¡rio ou atÃ© esgotarem"},
  {"Task ID":"ebgcZrv1Y0uxzBj86olsTJYAG7OU","Task Name":"FormaÃ§Ã£o de Equipas de Trabalho","Bucket Name":"Equipa de CoordenaÃ§Ã£o","Status":"In progress","Priority":"Urgent","Assigned To":null,"Created Date":"2026-02-16T18:34:23.6195988Z","Due date":"2026-02-24T10:00:00+00:00","Start date":null,"Late":"false","Completed Date":null,"Labels":"Data Importante","Description":null},
  {"Task ID":"gbeX7bmEf0iuXE5sDwZ2HZYANP8E","Task Name":"ReuniÃ£o com a Professora Margarida na aula de 24/2","Bucket Name":"Equipa de CoordenaÃ§Ã£o","Status":"Not started","Priority":"Urgent","Assigned To":null,"Created Date":"2026-02-16T16:19:48.6389029Z","Due date":"2026-02-24T10:00:00+00:00","Start date":"2026-02-24T10:00:00+00:00","Late":"false","Completed Date":null,"Labels":null,"Description":"1) Regulamento interno por equipa, ou por subequipa?\n2) Perguntar Ã  professora como Ã© que fazemos em relaÃ§Ã£o aos estudantes que lembram-se a meio do semestre que estÃ£o matriculados em SIO.\n3) Discutir as expectativas da equipa de coordenaÃ§Ã£o com a Prof Margarida"},
  {"Task ID":"nYFJgUEAu0KC_3fklCl4YZYAMaaK","Task Name":"Estudo sobre FormaÃ§Ã£o de Equipas de Trabalho","Bucket Name":"Equipa de CoordenaÃ§Ã£o","Status":"Completed","Priority":"Important","Assigned To":"Joel Sampaio Pinto;Ana Sofia GonÃ§alves Vaz;Maria Do Carmo Brito Carneiro;Rui Miguel Teixeira Borges De AraÃºjo;Cristiana Filipa Cunha Pinheiro","Created Date":"2026-02-16T16:10:12.0641335Z","Due date":"2026-02-21T10:00:00+00:00","Start date":"2026-02-14T10:00:00+00:00","Late":"false","Completed Date":"2026-02-21T13:11:37.2645017Z","Labels":null,"Description":null},
  {"Task ID":"vcHiWPPzPUOaUmcn_neadZYANkIZ","Task Name":"ConfirmaÃ§Ã£o de PatrocÃ­nios e AdaptaÃ§Ãµes na LogÃ­stica","Bucket Name":"Equipa de CoordenaÃ§Ã£o","Status":"Not started","Priority":"Important","Assigned To":null,"Created Date":"2026-02-16T18:43:08.7663195Z","Due date":"2026-05-19T10:00:00+00:00","Start date":null,"Late":"false","Completed Date":null,"Labels":"Data Importante","Description":null},
  {"Task ID":"w8PJMuh-MEmue8TaUe1tepYAFV8F","Task Name":"CriaÃ§Ã£o do Regulamento Interno da Equipa de CoordenaÃ§Ã£o","Bucket Name":"Equipa de CoordenaÃ§Ã£o","Status":"Completed","Priority":"Important","Assigned To":"Joel Sampaio Pinto","Created Date":"2026-02-16T16:16:13.9235287Z","Due date":"2026-02-21T10:00:00+00:00","Start date":"2026-02-14T10:00:00+00:00","Late":"false","Completed Date":"2026-02-21T16:36:00.5532346Z","Labels":null,"Description":null},
  {"Task ID":"yCyhRQq9qESK-uk-nBG3jZYAOxZd","Task Name":"ComposiÃ§Ã£o do Programa","Bucket Name":"Equipa de CoordenaÃ§Ã£o","Status":"Not started","Priority":"Important","Assigned To":null,"Created Date":"2026-02-16T18:39:35.736209Z","Due date":"2026-04-21T10:00:00+00:00","Start date":null,"Late":"false","Completed Date":null,"Labels":"Data Importante","Description":null},
  {"Task ID":"yiOG6dDgDEC4jnqhnOZ345YADbh3","Task Name":"Convidar Oradores e Moderadores","Bucket Name":"Equipa de CoordenaÃ§Ã£o","Status":"Not started","Priority":"Important","Assigned To":null,"Created Date":"2026-02-16T18:38:26.5950831Z","Due date":"2026-03-24T10:00:00+00:00","Start date":null,"Late":"false","Completed Date":null,"Labels":"Data Importante","Description":null}
];

const EXPORT_DATE = "2026-02-24";

// Bucket colours
const BUCKET_COLORS = {
  "Equipa de CoordenaÃ§Ã£o": "var(--coord)",
  "Equipa de LogÃ­stica e Infraestrutura": "var(--logistica)",
  "Equipa de Programa e ConteÃºdos": "var(--programa)",
  "Equipa de ComunicaÃ§Ã£o e DivulgaÃ§Ã£o": "var(--comms)",
  "Equipa de AngariaÃ§Ã£o de PatrocÃ­nios": "var(--patroc)",
  "Equipa de Acompanhamento e AvaliaÃ§Ã£o": "var(--acomp)"
};
const BUCKET_COLORS_HEX = {
  "Equipa de CoordenaÃ§Ã£o": "#6c8eff",
  "Equipa de LogÃ­stica e Infraestrutura": "#f97316",
  "Equipa de Programa e ConteÃºdos": "#22d3a0",
  "Equipa de ComunicaÃ§Ã£o e DivulgaÃ§Ã£o": "#e879f9",
  "Equipa de AngariaÃ§Ã£o de PatrocÃ­nios": "#facc15",
  "Equipa de Acompanhamento e AvaliaÃ§Ã£o": "#f87171"
};

// â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let dayWidth = 18; // px per day, adjustable via zoom
let filterBucket = 'all';
let filterStatus = 'all';
let collapsedBuckets = new Set();
// Sempre calculado no momento do loading da pÃ¡gina â€” nunca em cache
function getToday() {
  const d = new Date();
  d.setHours(0, 0, 0, 0);
  return d;
}
const today = getToday();

// â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function parseDate(str) {
  if (!str) return null;
  const m = String(str).match(/^(\d{4})-(\d{2})-(\d{2})/);
  if (!m) return null;
  return new Date(m[1], m[2]-1, m[3]);
}
function daysBetween(a, b) {
  return Math.round((b - a) / 86400000);
}
function formatDate(d) {
  if (!d) return 'â€”';
  return d.toLocaleDateString('pt-PT', {day:'2-digit', month:'short', year:'numeric'});
}
function shortName(full) {
  if (!full) return 'â€”';
  const parts = full.trim().split(' ');
  if (parts.length === 1) return parts[0];
  return parts[0] + ' ' + parts[parts.length-1];
}

// Derive chart start/end from all task dates
function getChartBounds() {
  let minDate = new Date(2026,0,1);
  let maxDate = new Date(2026,5,30);
  RAW_TASKS.forEach(t => {
    const s = parseDate(t['Start date']) || parseDate(t['Created Date']);
    const e = parseDate(t['Due date']);
    if (s && s < minDate) minDate = new Date(s);
    if (e && e > maxDate) maxDate = new Date(e);
  });
  // Add padding: 1 week before, 2 weeks after
  minDate.setDate(minDate.getDate() - 7);
  maxDate.setDate(maxDate.getDate() + 14);
  // Snap to Monday
  const dow = minDate.getDay();
  minDate.setDate(minDate.getDate() - (dow === 0 ? 6 : dow-1));
  return { minDate, maxDate };
}

// â”€â”€ PROCESS TASKS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Recalcula sempre com base na data de hoje no momento do loading
function processTasks() {
  const now = getToday(); // data real de hoje, calculada agora
  return RAW_TASKS.map(t => {
    const due = parseDate(t['Due date']);
    let start = parseDate(t['Start date']);
    if (!start) {
      if (due) { start = new Date(due); start.setDate(start.getDate() - 7); }
      else start = parseDate(t['Created Date']) || new Date();
    }
    const isMilestone = start.getTime() === due?.getTime();
    const isLate = t.Status !== 'Completed' && due && due < now;
    const progress = t.Status === 'Completed' ? 100 : t.Status === 'In progress' ? 50 : 0;
    return { ...t, startDate: start, dueDate: due, isMilestone, isLate, progress };
  });
}

// â”€â”€ GROUP BY BUCKET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function groupByBucket(tasks) {
  const groups = {};
  const order = [];
  tasks.forEach(t => {
    if (!groups[t['Bucket Name']]) {
      groups[t['Bucket Name']] = [];
      order.push(t['Bucket Name']);
    }
    groups[t['Bucket Name']].push(t);
  });
  return order.map(name => ({ name, tasks: groups[name] }));
}

// â”€â”€ RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const ROW_H = 36;
const BUCKET_H = 31;

let chartBounds, allTasks, buckets;

function init() {
  chartBounds = getChartBounds();
  allTasks = processTasks();
  buckets = groupByBucket(allTasks);

  document.getElementById('exportDate').textContent = 'Exportado em: ' + EXPORT_DATE;

  // populate filter
  const sel = document.getElementById('filterBucket');
  buckets.forEach(b => {
    const o = document.createElement('option');
    o.value = b.name; o.textContent = b.name;
    sel.appendChild(o);
  });
  sel.addEventListener('change', e => { filterBucket = e.target.value; render(); });
  document.getElementById('filterStatus').addEventListener('change', e => { filterStatus = e.target.value; render(); });

  renderStats();
  render();
  setTimeout(scrollToToday, 100);
}

function renderStats() {
  const total = allTasks.length;
  const done = allTasks.filter(t => t.Status === 'Completed').length;
  const prog = allTasks.filter(t => t.Status === 'In progress').length;
  const todo = allTasks.filter(t => t.Status === 'Not started').length;
  const late = allTasks.filter(t => t.isLate).length;
  const pct = Math.round((done/total)*100);
  document.getElementById('statsBar').innerHTML = `
    <div class="stat"><div class="stat-dot" style="background:#22c55e"></div><strong>${done}</strong> concluÃ­das</div>
    <div class="stat"><div class="stat-dot" style="background:#3b82f6"></div><strong>${prog}</strong> em progresso</div>
    <div class="stat"><div class="stat-dot" style="background:#64748b"></div><strong>${todo}</strong> por iniciar</div>
    ${late ? `<div class="stat"><div class="stat-dot" style="background:#ef4444"></div><strong>${late}</strong> em atraso</div>` : ''}
    <div class="stat" style="margin-left:auto">
      <strong style="color:#fff">${pct}%</strong>&nbsp;concluÃ­do
      <div style="width:80px;height:4px;background:#1e2333;border-radius:2px;overflow:hidden;margin-left:4px">
        <div style="width:${pct}%;height:100%;background:#22c55e;border-radius:2px"></div>
      </div>
    </div>`;
}

function getFilteredBuckets() {
  return buckets.map(b => ({
    ...b,
    tasks: b.tasks.filter(t => {
      if (filterBucket !== 'all' && t['Bucket Name'] !== filterBucket) return false;
      if (filterStatus !== 'all' && t.Status !== filterStatus) return false;
      return true;
    })
  })).filter(b => filterBucket === 'all' || b.name === filterBucket || b.tasks.length > 0);
}

function render() {
  const { minDate, maxDate } = chartBounds;
  const totalDays = daysBetween(minDate, maxDate);
  const totalWidth = totalDays * dayWidth;

  const visibleBuckets = getFilteredBuckets();

  // â”€â”€ LEFT PANEL â”€â”€
  const taskList = document.getElementById('taskList');
  taskList.innerHTML = '';

  // â”€â”€ CHART â”€â”€
  const chartInner = document.getElementById('chartInner');
  chartInner.innerHTML = '';
  chartInner.style.width = totalWidth + 'px';

  // Time header
  const timeHeader = document.createElement('div');
  timeHeader.className = 'time-header';
  timeHeader.style.width = totalWidth + 'px';

  // Generate weeks
  const weeks = [];
  let cur = new Date(minDate);
  while (cur <= maxDate) {
    weeks.push(new Date(cur));
    cur.setDate(cur.getDate() + 7);
  }

  // Month labels
  const months = {};
  weeks.forEach(w => {
    const key = w.getFullYear() + '-' + w.getMonth();
    if (!months[key]) months[key] = { date: new Date(w), x: daysBetween(minDate, w) * dayWidth };
  });
  Object.values(months).forEach(m => {
    const el = document.createElement('div');
    el.className = 'month-label';
    el.style.left = m.x + 'px';
    const mName = m.date.toLocaleDateString('pt-PT', { month:'long', year:'numeric' });
    el.textContent = mName.charAt(0).toUpperCase() + mName.slice(1);
    timeHeader.appendChild(el);
  });

  // Week cells
  weeks.forEach(w => {
    const cell = document.createElement('div');
    cell.className = 'week-cell';
    const isToday = w <= today && today < new Date(w.getTime() + 7*86400000);
    if (isToday) cell.classList.add('today-week');
    cell.style.width = (7 * dayWidth) + 'px';
    cell.style.flexShrink = '0';
    cell.textContent = w.toLocaleDateString('pt-PT', { day:'2-digit', month:'2-digit' });
    timeHeader.appendChild(cell);
  });
  chartInner.appendChild(timeHeader);

  // Chart rows container
  const chartRows = document.createElement('div');
  chartRows.className = 'chart-rows';
  chartRows.style.position = 'relative';

  // Grid lines
  let totalRowsHeight = 0;
  visibleBuckets.forEach(b => {
    totalRowsHeight += BUCKET_H;
    if (!collapsedBuckets.has(b.name)) totalRowsHeight += b.tasks.length * ROW_H;
  });

  weeks.forEach(w => {
    const x = daysBetween(minDate, w) * dayWidth;
    const line = document.createElement('div');
    line.className = 'grid-line';
    line.style.left = x + 'px';
    line.style.height = totalRowsHeight + 'px';
    chartRows.appendChild(line);
  });
  Object.values(months).forEach(m => {
    const line = document.createElement('div');
    line.className = 'grid-line month';
    line.style.left = m.x + 'px';
    line.style.height = totalRowsHeight + 'px';
    chartRows.appendChild(line);
  });

  // Today line
  if (today >= minDate && today <= maxDate) {
    const x = daysBetween(minDate, today) * dayWidth;
    const tl = document.createElement('div');
    tl.className = 'today-line';
    tl.style.left = x + 'px';
    tl.style.height = totalRowsHeight + 'px';
    chartRows.appendChild(tl);
  }

  // Render each bucket
  visibleBuckets.forEach(b => {
    const color = BUCKET_COLORS_HEX[b.name] || '#6c8eff';
    const collapsed = collapsedBuckets.has(b.name);

    // Left: bucket header
    const bHeader = document.createElement('div');
    bHeader.className = 'bucket-header';
    bHeader.innerHTML = `
      <div class="bucket-dot" style="background:${color}"></div>
      <div class="bucket-name">${b.name.replace('Equipa de ','')}</div>
      <div class="bucket-count">${b.tasks.length}</div>
      <div class="bucket-toggle ${collapsed ? 'collapsed' : ''}">â–¾</div>`;
    bHeader.addEventListener('click', () => {
      if (collapsedBuckets.has(b.name)) collapsedBuckets.delete(b.name);
      else collapsedBuckets.add(b.name);
      render();
    });
    taskList.appendChild(bHeader);

    // Chart: bucket spacer
    const spacer = document.createElement('div');
    spacer.className = 'bucket-spacer';
    spacer.style.width = totalWidth + 'px';
    chartRows.appendChild(spacer);

    if (!collapsed) {
      b.tasks.forEach((t, idx) => {
        // Left row
        const row = document.createElement('div');
        row.className = 'task-row';
        row.dataset.id = t['Task ID'];
        const statusKey = t.Status.replace(/ /g, '-');
        const firstAssignee = t['Assigned To'] ? t['Assigned To'].split(';')[0] : null;
        row.innerHTML = `
          <div class="task-name">${t['Task Name']}${t.isLate ? '<span class="late-icon">âš </span>' : ''}</div>
          <div class="task-assignee">${firstAssignee ? shortName(firstAssignee) : 'â€”'}</div>
          <div><span class="status-badge status-${statusKey}">${t.Status === 'Completed' ? 'âœ“ Feito' : t.Status === 'In progress' ? 'âŸ³ Prog.' : 'â—‹ InÃ­cio'}</span></div>`;
        taskList.appendChild(row);
        row.addEventListener('click', () => openDetailPanel(t));

        // Chart row
        const chartRow = document.createElement('div');
        chartRow.className = 'chart-row';
        chartRow.style.width = totalWidth + 'px';
        const rowBg = document.createElement('div');
        rowBg.className = 'row-bg';
        chartRow.appendChild(rowBg);

        // Determine bar color
        let barColor;
        if (t.isLate) barColor = '#ef4444';
        else if (t.Status === 'Completed') barColor = '#22c55e';
        else if (t.Status === 'In progress') barColor = '#3b82f6';
        else barColor = '#475569';

        if (t.isMilestone) {
          // Draw diamond
          if (t.dueDate) {
            const x = daysBetween(minDate, t.dueDate) * dayWidth;
            const diamond = document.createElement('div');
            diamond.className = 'gantt-milestone';
            diamond.style.left = (x - 6) + 'px';
            attachTooltip(diamond, t);
            chartRow.appendChild(diamond);
          }
        } else {
          const s = t.startDate;
          const e = t.dueDate;
          if (s && e) {
            const x1 = Math.max(0, daysBetween(minDate, s) * dayWidth);
            const x2 = Math.min(totalWidth, daysBetween(minDate, e) * dayWidth);
            const w = Math.max(4, x2 - x1);
            const bar = document.createElement('div');
            bar.className = 'gantt-bar';
            bar.style.left = x1 + 'px';
            bar.style.width = w + 'px';
            bar.style.background = barColor;
            bar.style.opacity = t.Status === 'Not started' ? '0.7' : '1';
            if (t.progress > 0 && t.progress < 100) {
              const prog = document.createElement('div');
              prog.className = 'bar-progress';
              prog.style.width = t.progress + '%';
              bar.appendChild(prog);
            }
            if (w > 30) {
              const label = document.createElement('div');
              label.className = 'bar-label';
              label.textContent = t['Task Name'];
              bar.appendChild(label);
            }
            attachTooltip(bar, t);
            chartRow.appendChild(bar);
          }
        }

        chartRows.appendChild(chartRow);

        // Cross-highlight
        row.addEventListener('mouseenter', () => {
          row.classList.add('highlighted');
          chartRow.querySelector('.row-bg').style.opacity = '1';
        });
        row.addEventListener('mouseleave', () => {
          row.classList.remove('highlighted');
          chartRow.querySelector('.row-bg').style.opacity = '0';
        });
      });
    }
  });

  chartInner.appendChild(chartRows);

  // Sync vertical scroll
  const taskListEl = document.getElementById('taskList');
  const chartScrollEl = document.getElementById('chartScroll');
  taskListEl.addEventListener('scroll', () => { chartScrollEl.scrollTop = taskListEl.scrollTop; }, { passive:true });
  chartScrollEl.addEventListener('scroll', () => { taskListEl.scrollTop = chartScrollEl.scrollTop; }, { passive:true });
}

// â”€â”€ TOOLTIP (hover rÃ¡pido) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const tooltip = document.getElementById('tooltip');
function attachTooltip(el, t) {
  el.addEventListener('mouseenter', e => showTooltip(e, t));
  el.addEventListener('mousemove', e => moveTooltip(e));
  el.addEventListener('mouseleave', hideTooltip);
  el.addEventListener('click', e => { e.stopPropagation(); hideTooltip(); openDetailPanel(t); });
}
function showTooltip(e, t) {
  const statusLabel = t.Status === 'Completed' ? 'âœ“ ConcluÃ­do' : t.Status === 'In progress' ? 'âŸ³ Em progresso' : 'â—‹ Por iniciar';
  tooltip.innerHTML = `
    <div class="tt-title">${t['Task Name']}</div>
    <div style="font-size:11px;color:var(--text-dim);margin-top:4px">${statusLabel} Â· ${formatDate(t.dueDate)}</div>
    ${t.isLate ? '<div style="font-size:10px;color:#ef4444;margin-top:4px">âš  Em atraso</div>' : ''}
    <div class="tt-hint">ğŸ–± Clica para ver detalhes e notas</div>
  `;
  tooltip.classList.add('visible');
  moveTooltip(e);
}
function moveTooltip(e) {
  const tw = tooltip.offsetWidth, th = tooltip.offsetHeight;
  let x = e.clientX + 16, y = e.clientY - 16;
  if (x + tw > window.innerWidth - 10) x = e.clientX - tw - 16;
  if (y + th > window.innerHeight - 10) y = e.clientY - th - 16;
  tooltip.style.left = x + 'px';
  tooltip.style.top = y + 'px';
}
function hideTooltip() { tooltip.classList.remove('visible'); }

// â”€â”€ DETAIL PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openDetailPanel(t) {
  const statusColors = { 'Completed': '#22c55e', 'In progress': '#3b82f6', 'Not started': '#64748b' };
  const statusLabels = { 'Completed': 'âœ“ ConcluÃ­do', 'In progress': 'âŸ³ Em progresso', 'Not started': 'â—‹ Por iniciar' };
  const statusBg =     { 'Completed': '#14532d', 'In progress': '#1e3a5f', 'Not started': '#1e2333' };
  const color = t.isLate ? '#ef4444' : (statusColors[t.Status] || '#64748b');

  // Header
  document.getElementById('dpStatusDot').style.background = color;
  document.getElementById('dpTitle').textContent = t['Task Name'];

  // Meta grid
  const meta = document.getElementById('dpMeta');
  const statusBadge = `<span class="dp-status-badge" style="background:${statusBg[t.Status]};color:${statusColors[t.Status]}">${statusLabels[t.Status]}</span>`;
  meta.innerHTML = `
    <div class="dp-meta-item">
      <div class="dp-meta-label">Estado</div>
      <div class="dp-meta-value">${statusBadge}</div>
    </div>
    <div class="dp-meta-item">
      <div class="dp-meta-label">Prioridade</div>
      <div class="dp-meta-value">${t.Priority === 'Urgent' ? 'ğŸ”´ Urgente' : t.Priority === 'Important' ? 'ğŸŸ¡ Importante' : t.Priority || 'â€”'}</div>
    </div>
    <div class="dp-meta-item">
      <div class="dp-meta-label">Data de inÃ­cio</div>
      <div class="dp-meta-value">${formatDate(t.startDate)}</div>
    </div>
    <div class="dp-meta-item">
      <div class="dp-meta-label">Data limite</div>
      <div class="dp-meta-value" style="${t.isLate ? 'color:#ef4444' : ''}">${formatDate(t.dueDate)}${t.isLate ? ' âš ' : ''}</div>
    </div>
    ${t['Completed Date'] ? `
    <div class="dp-meta-item">
      <div class="dp-meta-label">ConcluÃ­do em</div>
      <div class="dp-meta-value" style="color:#22c55e">${formatDate(parseDate(t['Completed Date']))}</div>
    </div>` : ''}
    <div class="dp-meta-item">
      <div class="dp-meta-label">Equipa</div>
      <div class="dp-meta-value" style="color:${BUCKET_COLORS_HEX[t['Bucket Name']] || '#6c8eff'}">${t['Bucket Name'].replace('Equipa de ','')}</div>
    </div>
    ${t.Labels ? `
    <div class="dp-meta-item" style="grid-column:1/-1">
      <div class="dp-meta-label">Label</div>
      <div class="dp-meta-value"><span style="background:#2d2a14;color:#facc15;padding:2px 8px;border-radius:4px;font-size:11px">ğŸ· ${t.Labels}</span></div>
    </div>` : ''}
  `;

  // Notes section
  const notes = document.getElementById('dpNotesSection');
  const assignees = t['Assigned To'] ? t['Assigned To'].split(';').map(s => s.trim()).filter(Boolean) : [];
  const avatarColors = ['#6c8eff','#22d3a0','#e879f9','#facc15','#f97316','#f87171'];

  notes.innerHTML = `
    <div class="dp-section-label">ğŸ“ Notas da Tarefa</div>
    ${t.Description
      ? `<div class="dp-notes-content">${escHtml(t.Description)}</div>`
      : `<div class="dp-notes-empty">Sem notas para esta tarefa.<br>Adiciona notas no Planner para as ver aqui.</div>`
    }
    ${assignees.length ? `
    <div class="dp-assignees">
      <div class="dp-section-label" style="margin-top:20px">ğŸ‘¥ ResponsÃ¡veis</div>
      <div class="dp-assignee-list">
        ${assignees.map((a, i) => {
          const initials = a.split(' ').filter(Boolean).map(w=>w[0]).slice(0,2).join('').toUpperCase();
          return `<div class="dp-assignee-chip">
            <div class="dp-assignee-avatar" style="background:${avatarColors[i % avatarColors.length]}">${initials}</div>
            ${a}
          </div>`;
        }).join('')}
      </div>
    </div>` : ''}
  `;

  // Footer
  const footer = document.getElementById('dpFooter');
  const progColor = t.isLate ? '#ef4444' : (statusColors[t.Status] || '#64748b');
  footer.innerHTML = `
    ${t.isLate ? '<div class="dp-late-badge">âš  Em atraso</div>' : ''}
    <div style="font-size:11px;color:var(--text-muted);flex-shrink:0">Progresso ${t.progress}%</div>
    <div class="dp-progress-bar">
      <div class="dp-progress-fill" style="width:${t.progress}%;background:${progColor}"></div>
    </div>
  `;

  document.getElementById('detailOverlay').classList.add('open');
  document.getElementById('detailPanel').classList.add('open');
}

function closeDetailPanel() {
  document.getElementById('detailOverlay').classList.remove('open');
  document.getElementById('detailPanel').classList.remove('open');
}

function escHtml(str) {
  return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

document.addEventListener('keydown', e => { if (e.key === 'Escape') closeDetailPanel(); });

// â”€â”€ ZOOM & SCROLL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function changeZoom(delta) {
  dayWidth = Math.min(60, Math.max(6, dayWidth + delta));
  render();
}
function scrollToToday() {
  const { minDate } = chartBounds;
  const x = daysBetween(minDate, today) * dayWidth - 200;
  document.getElementById('chartScroll').scrollLeft = Math.max(0, x);
}

// â”€â”€ BOOT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
init();
</script>
</body>
</html>
